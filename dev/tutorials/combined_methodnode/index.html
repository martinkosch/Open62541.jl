<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Simple Method Nodes · Open62541.jl</title><meta name="title" content="Simple Method Nodes · Open62541.jl"/><meta property="og:title" content="Simple Method Nodes · Open62541.jl"/><meta property="twitter:title" content="Simple Method Nodes · Open62541.jl"/><meta name="description" content="Documentation for Open62541.jl."/><meta property="og:description" content="Documentation for Open62541.jl."/><meta property="twitter:description" content="Documentation for Open62541.jl."/><meta property="og:url" content="https://martinkosch.github.io/Open62541.jl/tutorials/combined_methodnode/"/><meta property="twitter:url" content="https://martinkosch.github.io/Open62541.jl/tutorials/combined_methodnode/"/><link rel="canonical" href="https://martinkosch.github.io/Open62541.jl/tutorials/combined_methodnode/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Open62541.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../server_first_steps/">First steps: Server</a></li><li><a class="tocitem" href="../client_first_steps/">First steps: Client</a></li><li><a class="tocitem" href="../combined_variables/">Adding and reading/writing variables</a></li><li><a class="tocitem" href="../combined_username_password_login/">Username/password authentication using basic access control</a></li><li><a class="tocitem" href="../combined_encrypted_un_pw_login/">Encrypted username/password authentication using basic access control</a></li><li class="is-active"><a class="tocitem" href>Simple Method Nodes</a><ul class="internal"><li><a class="tocitem" href="#Configuring-the-server"><span>Configuring the server</span></a></li><li><a class="tocitem" href="#Method-calling-using-client-API"><span>Method calling using client API</span></a></li><li><a class="tocitem" href="#More-flexibility-in-method-definitions"><span>More flexibility in method definitions</span></a></li></ul></li><li><a class="tocitem" href="../further_resources/">Further resources</a></li></ul></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/numbertypes/">Supported number types</a></li><li><a class="tocitem" href="../../manual/nodeid/">Nodeid</a></li><li><a class="tocitem" href="../../manual/attributegeneration/">Attribute generation</a></li><li><a class="tocitem" href="../../manual/server/">Server</a></li><li><a class="tocitem" href="../../manual/client/">Client</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../reference_lowlevel/">Low level interface</a></li><li><a class="tocitem" href="../../reference_highlevel/">High level interface</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Simple Method Nodes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Simple Method Nodes</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/martinkosch/Open62541.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/martinkosch/Open62541.jl/blob/main/docs/src/tutorials/combined_methodnode.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Simple-Method-Nodes"><a class="docs-heading-anchor" href="#Simple-Method-Nodes">Simple Method Nodes</a><a id="Simple-Method-Nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Simple-Method-Nodes" title="Permalink"></a></h1><p>In this tutorial, we will add method nodes to a server. A method node takes input(s), calls a function (or method) on the server side and calculates output(s) based on the input(s). We will then proceed to call the new method nodes using the client API.</p><p>In  Open62541.jl there is a convenient high level interface for this that simplifies these operations, at the price of some flexibility when defining the methods. In the final section of this tutorial, we will show how more flexible methods can be defined and used by employing the low level interface.</p><h2 id="Configuring-the-server"><a class="docs-heading-anchor" href="#Configuring-the-server">Configuring the server</a><a id="Configuring-the-server-1"></a><a class="docs-heading-anchor-permalink" href="#Configuring-the-server" title="Permalink"></a></h2><p>Here we configure the server to accept a username/password combination. We will also disallow anonymous logins. The code block is commented line by line.</p><pre><code class="language-julia hljs">using Open62541
using Pkg.BinaryPlatforms

#configure the open62541 server; we choose a default config on port 4840.
server = JUA_Server()
config = JUA_ServerConfig(server)
JUA_ServerConfig_setDefault(config)

#define Julia functions that will be used within the method nodes
#A one input, one output method. Classical &quot;Hello World!&quot;.
function simple_one_in_one_out(name)
    assembledstring = &quot;Hello &quot; * name * &quot;.&quot;
    return assembledstring
end

#A two input, two output method. It will say hello and square a number.
function simple_two_in_two_out(name, number)
    out1 = &quot;Hello &quot; * name * &quot;.&quot;
    out2 = number * number
    return (out1, out2)
end

#prepare method attributes
attr1 = JUA_MethodAttributes(description = &quot;Simple One in One Out&quot;,
    displayname = &quot;Simple One in One Out&quot;,
    executable = true, #makes the method node executable via server API
    userexecutable = true) #makes the method executable via client API
attr2 = JUA_MethodAttributes(description = &quot;Simple Two in Two Out - Mixed Types&quot;,
    displayname = &quot;Simple Two in Two Out - Mixed Types&quot;,
    executable = true,
    userexecutable = true)

#define nodeids for the two methods:
methodid1 = JUA_NodeId(1, 62541)
methodid2 = JUA_NodeId(1, 62542)

#parent and reference nodeid:
parentnodeid = JUA_NodeId(0, UA_NS0ID_OBJECTSFOLDER) #method nodes will appear in &quot;Objects&quot;
parentreferencenodeid = JUA_NodeId(0, UA_NS0ID_HASCOMPONENT)

#define browsenames for the two method nodes
browsename1 = JUA_QualifiedName(1, &quot;Simple One in One Out&quot;)
browsename2 = JUA_QualifiedName(1, &quot;Simple Two in Two Out&quot;)

#prepare method callbacks
#the following code is necessary, because Apple silicon does not currently support closures 
#within @cfunction, see ?@cfunction. If you are on Windows/*nix, you can just use the 
#UA_MethodCallback_wrap(...) part; on Apple Silicon, the longer and more cumbersome part is 
#used instead.
@static if !Sys.isapple() || platform_key_abi().tags[&quot;arch&quot;] != &quot;aarch64&quot;
    m1 = UA_MethodCallback_generate(UA_MethodCallback_wrap(simple_one_in_one_out))
    m2 = UA_MethodCallback_generate(UA_MethodCallback_wrap(simple_two_in_two_out))
else #we are on Apple Silicon and can&#39;t use a closure in @cfunction, have to do more work.
    function c1(server, sessionId, sessionHandle, methodId, methodContext, objectId,
            objectContext, inputSize, input, outputSize, output)
        arr_input = UA_Array(input, Int64(inputSize))
        arr_output = UA_Array(output, Int64(outputSize))
        input_julia = Open62541.__get_juliavalues_from_variant.(arr_input, Any)
        output_julia = simple_one_in_one_out(input_julia...)
        if !isa(output_julia, Tuple)
            output_julia = (output_julia,)
        end
        for i in 1:outputSize
            j = JUA_Variant(output_julia[i])
            UA_Variant_copy(Open62541.Jpointer(j), arr_output[i])
        end
        return UA_STATUSCODE_GOOD
    end
    function c2(server, sessionId, sessionHandle, methodId, methodContext, objectId,
            objectContext, inputSize, input, outputSize, output)
        arr_input = UA_Array(input, Int64(inputSize))
        arr_output = UA_Array(output, Int64(outputSize))
        input_julia = Open62541.__get_juliavalues_from_variant.(arr_input, Any)
        output_julia = simple_two_in_two_out(input_julia...)
        if !isa(output_julia, Tuple)
            output_julia = (output_julia,)
        end
        for i in 1:outputSize
            j = JUA_Variant(output_julia[i])
            UA_Variant_copy(Open62541.Jpointer(j), arr_output[i])
        end
        return UA_STATUSCODE_GOOD
    end
    m1 = @cfunction(c1, UA_StatusCode,
        (Ptr{UA_Server}, Ptr{UA_NodeId}, Ptr{Cvoid},
            Ptr{UA_NodeId}, Ptr{Cvoid}, Ptr{UA_NodeId}, Ptr{Cvoid},
            Csize_t, Ptr{UA_Variant}, Csize_t, Ptr{UA_Variant}))
    m2 = @cfunction(c2, UA_StatusCode,
        (Ptr{UA_Server}, Ptr{UA_NodeId}, Ptr{Cvoid},
            Ptr{UA_NodeId}, Ptr{Cvoid}, Ptr{UA_NodeId}, Ptr{Cvoid},
            Csize_t, Ptr{UA_Variant}, Csize_t, Ptr{UA_Variant}))
end

#create example input and output arguments
oneinputarg = JUA_Argument(&quot;examplestring&quot;, name = &quot;One input&quot;, description = &quot;One input&quot;)
j1 = JUA_Argument(&quot;examplestring&quot;, name = &quot;Name&quot;, description = &quot;Number&quot;)
j2 = JUA_Argument(25, name = &quot;Number&quot;, description = &quot;Number&quot;)
twoinputarg = [j1, j2]

oneoutputarg = JUA_Argument(
    &quot;examplestring&quot;, name = &quot;One output&quot;, description = &quot;One output&quot;)
j3 = JUA_Argument(&quot;examplestring&quot;, name = &quot;Name&quot;, description = &quot;Name&quot;)
j4 = JUA_Argument(25, name = &quot;Number&quot;, description = &quot;Number&quot;)
twooutputarg = [j3, j4]

#Add the method nodes to the server
retval1 = JUA_Server_addNode(server, methodid1, parentnodeid, parentreferencenodeid,
    browsename1, attr1, m1, oneinputarg, oneoutputarg,
    JUA_NodeId(), JUA_NodeId())
retval2 = JUA_Server_addNode(server, methodid2, parentnodeid, parentreferencenodeid,
    browsename2, attr2, m2, twoinputarg, twooutputarg,
    JUA_NodeId(), JUA_NodeId())

#For testing purposes, let&#39;s call the methods using the Server API. The more common use case, 
#that is calling the method node on a remote server via the Client API is shown below.
testinput1 = &quot;Peter&quot;
testinput2 = (&quot;Claudia&quot;, 25)
res1 = JUA_Server_call(server, parentnodeid, methodid1, testinput1) # &quot;Hello Peter.&quot;
res2 = JUA_Server_call(server, parentnodeid, methodid2, testinput2) # (&quot;Hello Claudia.&quot;, 625)

#start the server, shut it down by pressing CTRL+C repeatedly once you are finished with it.
JUA_Server_runUntilInterrupt(server)</code></pre><p>You can verify that the server has been correctly configured using, for example, a graphical client, such as <a href="https://www.unified-automation.com/products/development-tools/uaexpert.html">UA Expert</a>.</p><p>In the following, we will access the server by calling the newly added method nodes through the client API.</p><h2 id="Method-calling-using-client-API"><a class="docs-heading-anchor" href="#Method-calling-using-client-API">Method calling using client API</a><a id="Method-calling-using-client-API-1"></a><a class="docs-heading-anchor-permalink" href="#Method-calling-using-client-API" title="Permalink"></a></h2><p>In the following, we use the client API to call the newly established method nodes on the server. In order to do so, start a new Julia session and run the program shown below. Once you are finished, you may want to return to the first Julia session and stop the server (press CTRL + C repeatedly).</p><pre><code class="language-julia hljs">using Open62541

#initiate client, configure it and connect to server
client = JUA_Client()
config = JUA_ClientConfig(client)
JUA_ClientConfig_setDefault(config)
JUA_Client_connect(client, &quot;opc.tcp://localhost:4840&quot;)

#re-define methodids and parentnodeid; remember, we are in a new Julia session.
methodid1 = JUA_NodeId(1, 62541)
methodid2 = JUA_NodeId(1, 62542)
parentnodeid = JUA_NodeId(0, UA_NS0ID_OBJECTSFOLDER)

#Define the input arguments
one_input = &quot;Peter&quot;
two_inputs = (&quot;Claudia&quot;, 25)

#Call the method nodes
response1 = JUA_Client_call(client, parentnodeid, methodid1, one_input)
response2 = JUA_Client_call(client, parentnodeid, methodid2, two_inputs)

JUA_Client_disconnect(client) #disconnect</code></pre><p><code>response1</code> should be a string &quot;Hello Peter.&quot;, whereas <code>response2</code> should be the tuple <code>(&quot;Hello Claudia.&quot;, 625)</code>.</p><h2 id="More-flexibility-in-method-definitions"><a class="docs-heading-anchor" href="#More-flexibility-in-method-definitions">More flexibility in method definitions</a><a id="More-flexibility-in-method-definitions-1"></a><a class="docs-heading-anchor-permalink" href="#More-flexibility-in-method-definitions" title="Permalink"></a></h2><p>When configuring the server, expect for the case of Apple Silicon (see server section above), we have employed the high level functions <code>UA_MethodCallback_wrap</code> and <code>UA_MethodCallback_generate</code>. The former assumes that the output of the method your are calling solely depends on the user inputs provided, but <em>not</em> on the state of the server, the session id, etc.</p><p>The Apple Silicon part of the server section above details how methods with more flexibility can be defined (which is more cumbersome, because the lower level interface is used). It is repeated below with more explanations.</p><pre><code class="language-julia hljs">using Open62541

#Define a more flexible method where one can also access server state, session id, etc.
#The function signature expected is:
#ret::UA_StatusCode = c2(server::Ptr{UA_Server}, sessionId::Ptr{UA_NodeId}, 
#    sessionHandle::Ptr{Cvoid}, methodId::Ptr{UA_NodeId}, methodContext::Ptr{Cvoid}, 
#    objectId::Ptr{UA_NodeId}, objectContext::Ptr{Cvoid}, inputSize::Csize_t, 
#    input::Ptr{UA_Variant}, outputSize::Csize_t, output::Ptr{UA_Variant}))

function c2(server, sessionId, sessionHandle, methodId, methodContext, objectId,
        objectContext, inputSize, input, outputSize, output)
    #define array wrappers for easier access of the corresponding memory
    arr_input = UA_Array(input, Int64(inputSize))
    arr_output = UA_Array(output, Int64(outputSize))

    #get input values in the form of a Julia tuple.
    input_julia = Open62541.__get_juliavalues_from_variant.(arr_input, Any)

    #prepare outputs
    output_julia = ... #whatever you want to do with all the input arguments

    #wraps singular output into tuple to process below.
    if !isa(output_julia, Tuple)
        output_julia = (output_julia,)
    end

    #copy Julia outputs into the memory where open62541 expects the results to be.
    for i in 1:outputSize
        j = JUA_Variant(output_julia[i])
        UA_Variant_copy(Open62541.Jpointer(j), arr_output[i])
    end

    #return a statuscode; obviously, might want to do some error catching if things don&#39;t work.
    return UA_STATUSCODE_GOOD
end

#create Ptr{Cvoid} expected when adding the method node to the server (if *not* on Apple 
#Silicon, this part can also be done with UA_MethodCallback_generate)
m2 = @cfunction(c2, UA_StatusCode,
    (Ptr{UA_Server}, Ptr{UA_NodeId}, Ptr{Cvoid},
        Ptr{UA_NodeId}, Ptr{Cvoid}, Ptr{UA_NodeId}, Ptr{Cvoid},
        Csize_t, Ptr{UA_Variant}, Csize_t, Ptr{UA_Variant}))</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../combined_encrypted_un_pw_login/">« Encrypted username/password authentication using basic access control</a><a class="docs-footer-nextpage" href="../further_resources/">Further resources »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 26 August 2025 11:17">Tuesday 26 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
